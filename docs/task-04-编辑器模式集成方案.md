# Draw.io ç¼–è¾‘å™¨æ¨¡å¼é›†æˆæŠ€æœ¯æ–¹æ¡ˆï¼ˆå®Œå…¨æœ¬åœ°åŒ–ç‰ˆæœ¬ï¼‰

## 1. å¯è¡Œæ€§åˆ†æ

### 1.1 ç»“è®º
**âœ… å®Œå…¨å¯è¡Œ - é‡‡ç”¨æœ¬åœ°åŒ–æ–¹æ¡ˆ**

**é‡è¦æ›´æ–°**ï¼šåŸºäºæ•°æ®å®‰å…¨è€ƒè™‘ï¼Œæˆ‘ä»¬**ä¸ä½¿ç”¨** `embed.diagrams.net` å¤–éƒ¨æœåŠ¡ï¼Œè€Œæ˜¯é‡‡ç”¨**å®Œå…¨æœ¬åœ°åŒ–**çš„æ–¹æ¡ˆï¼Œå°† draw.io ç¼–è¾‘å™¨æ‰“åŒ…åˆ°æ‰©å±•ä¸­ï¼Œæ‰€æœ‰æ•°æ®å¤„ç†å®Œå…¨åœ¨æœ¬åœ°å®Œæˆã€‚

### 1.2 æœ¬åœ°åŒ–æ–¹æ¡ˆçš„æŠ€æœ¯åŸºç¡€

1. **Draw.io æ˜¯çº¯å‰ç«¯åº”ç”¨**ï¼šdraw.io çš„æ ¸å¿ƒç¼–è¾‘å™¨æ˜¯çº¯ JavaScript å®¢æˆ·ç«¯åº”ç”¨ï¼Œä¸ä¾èµ–æœåŠ¡å™¨
2. **å¯ç‹¬ç«‹éƒ¨ç½²**ï¼šdraw.io çš„ `src/main/webapp` ç›®å½•åŒ…å«å®Œæ•´çš„ç¼–è¾‘å™¨ä»£ç 
3. **æˆåŠŸæ¡ˆä¾‹éªŒè¯**ï¼š
   - **VS Code Draw.io æ‰©å±•**ï¼šå°†å®Œæ•´çš„ draw.io ç¼–è¾‘å™¨æ‰“åŒ…åˆ°æ‰©å±•ä¸­ï¼Œå®ç°å®Œå…¨ç¦»çº¿ç¼–è¾‘
   - **drawio-local é¡¹ç›®**ï¼šçº¯æœ¬åœ°éƒ¨ç½²çš„ draw.ioï¼Œç¦ç”¨æ‰€æœ‰å¤–éƒ¨è¿æ¥
   - **draw.io Desktop**ï¼šElectron åº”ç”¨ï¼Œå®Œå…¨æœ¬åœ°è¿è¡Œ

### 1.3 æŠ€æœ¯ä¼˜åŠ¿

- âœ… **æ•°æ®å®‰å…¨**ï¼šæ‰€æœ‰æ•°æ®å®Œå…¨åœ¨æœ¬åœ°å¤„ç†ï¼Œä¸å‘é€åˆ°ä»»ä½•å¤–éƒ¨æœåŠ¡å™¨
- âœ… **å®Œå…¨ç¦»çº¿**ï¼šæ— éœ€ç½‘ç»œè¿æ¥å³å¯ç¼–è¾‘
- âœ… **åŠŸèƒ½å®Œæ•´**ï¼šåŒ…å«å®Œæ•´çš„ draw.io ç¼–è¾‘å™¨åŠŸèƒ½
- âœ… **æ€§èƒ½ä¼˜ç§€**ï¼šæœ¬åœ°åŠ è½½ï¼Œæ— ç½‘ç»œå»¶è¿Ÿ
- âœ… **éšç§ä¿æŠ¤**ï¼šä¼ä¸šå†…éƒ¨æ•°æ®ä¸ä¼šæ³„éœ²

### 1.4 å·²éªŒè¯çš„æˆåŠŸæ¡ˆä¾‹

å¤šä¸ªé¡¹ç›®å·²æˆåŠŸå®ç°å®Œå…¨æœ¬åœ°åŒ–çš„ draw.io é›†æˆï¼š
- **VS Code Draw.io æ‰©å±•**ï¼š9.4k starsï¼Œæ‰“åŒ…å®Œæ•´ç¼–è¾‘å™¨åˆ°æ‰©å±•ä¸­
- **drawio-local**ï¼šçº¯æœ¬åœ°éƒ¨ç½²æ–¹æ¡ˆï¼Œç¦ç”¨æ‰€æœ‰å¤–éƒ¨è¿æ¥
- **draw.io Desktop**ï¼šå®˜æ–¹æ¡Œé¢åº”ç”¨ï¼Œå®Œå…¨æœ¬åœ°è¿è¡Œ
- å¤šä¸ªä¼ä¸šå†…éƒ¨éƒ¨ç½²çš„ draw.io å®ä¾‹

## 2. æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡ï¼ˆæœ¬åœ°åŒ–æ–¹æ¡ˆï¼‰

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Browser Extension                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Content Script (ISOLATED)                 â”‚  â”‚
â”‚  â”‚  - æ£€æµ‹ draw.io æ–‡ä»¶                                    â”‚  â”‚
â”‚  â”‚  - æå– XML å†…å®¹                                        â”‚  â”‚
â”‚  â”‚  - åˆ›å»ºç¼–è¾‘å™¨å®¹å™¨                                       â”‚  â”‚
â”‚  â”‚  - åŠ è½½æœ¬åœ° draw.io ç¼–è¾‘å™¨                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â†• ç›´æ¥ API è°ƒç”¨                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         æœ¬åœ° Draw.io ç¼–è¾‘å™¨ï¼ˆæ‰“åŒ…åœ¨æ‰©å±•ä¸­ï¼‰            â”‚  â”‚
â”‚  â”‚  ğŸ“¦ /drawio-editor/                                    â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ js/app.min.js (ç¼–è¾‘å™¨æ ¸å¿ƒ)                      â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ js/viewer-static.min.js (æŸ¥çœ‹å™¨)               â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ mxgraph/ (å›¾å½¢åº“)                               â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ styles/ (æ ·å¼æ–‡ä»¶)                              â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ shapes/ (å½¢çŠ¶åº“)                                â”‚  â”‚
â”‚  â”‚    â””â”€â”€ index.html (ç¼–è¾‘å™¨å…¥å£)                         â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  - å®Œæ•´çš„ draw.io ç¼–è¾‘å™¨                               â”‚  â”‚
â”‚  â”‚  - æ‰€æœ‰æ•°æ®åœ¨æœ¬åœ°å¤„ç†                                  â”‚  â”‚
â”‚  â”‚  - æ— å¤–éƒ¨ç½‘ç»œè¯·æ±‚                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Clipboard Manager                         â”‚  â”‚
â”‚  â”‚  - å¤åˆ¶ç¼–è¾‘åçš„ XML                                    â”‚  â”‚
â”‚  â”‚  - æä¾›ç”¨æˆ·å‹å¥½çš„å¤åˆ¶ç•Œé¢                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… æ‰€æœ‰æ•°æ®å®Œå…¨åœ¨æœ¬åœ°å¤„ç†
âœ… æ— éœ€ä»»ä½•å¤–éƒ¨ç½‘ç»œè¿æ¥
âœ… ä¼ä¸šæ•°æ®å®Œå…¨å®‰å…¨
```

### 2.2 æ ¸å¿ƒæŠ€æœ¯æ ˆ

#### 2.2.1 æœ¬åœ° Draw.io ç¼–è¾‘å™¨é›†æˆ

**æ–¹æ¡ˆé€‰æ‹©**ï¼šå‚è€ƒ VS Code Draw.io æ‰©å±•å’Œ drawio-local é¡¹ç›®çš„å®ç°æ–¹å¼

**æ ¸å¿ƒæ–‡ä»¶ç»“æ„**ï¼š
```
extension/
â”œâ”€â”€ drawio-editor/           # æœ¬åœ° draw.io ç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ index.html          # ç¼–è¾‘å™¨å…¥å£é¡µé¢
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ app.min.js      # ç¼–è¾‘å™¨æ ¸å¿ƒï¼ˆ~2MBï¼‰
â”‚   â”‚   â””â”€â”€ PreConfig.js    # é…ç½®æ–‡ä»¶ï¼ˆç¦ç”¨å¤–éƒ¨è¿æ¥ï¼‰
â”‚   â”œâ”€â”€ mxgraph/            # mxGraph å›¾å½¢åº“
â”‚   â”œâ”€â”€ styles/             # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ shapes/             # å½¢çŠ¶åº“
â”‚   â”œâ”€â”€ stencils/           # æ¨¡æ¿
â”‚   â””â”€â”€ resources/          # èµ„æºæ–‡ä»¶
```

**PreConfig.js é…ç½®**ï¼ˆç¦ç”¨æ‰€æœ‰å¤–éƒ¨è¿æ¥ï¼‰ï¼š
```javascript
window.DRAWIO_BASE_URL = null;  // ç¦ç”¨å¤–éƒ¨ URL
window.DRAWIO_VIEWER_URL = null;
window.DRAWIO_LIGHTBOX_URL = null;

// ç¦ç”¨æ‰€æœ‰åœ¨çº¿å­˜å‚¨
window.DRAWIO_CONFIG = {
  defaultLibraries: 'general',
  enabledLibraries: ['general', 'uml', 'er', 'flowchart'],
  
  // ç¦ç”¨å¤–éƒ¨è¿æ¥
  offline: true,
  local: true,
  
  // ç¦ç”¨åœ¨çº¿åŠŸèƒ½
  showRemoteIcon: false,
  showStartScreen: false,
  
  // ç¦ç”¨å¤–éƒ¨å­˜å‚¨
  plugins: [],
  
  // è‡ªå®šä¹‰ UI
  ui: 'min',  // æˆ– 'atlas', 'kennedy'
  
  // ç¦ç”¨æ¨¡æ¿ï¼ˆéœ€è¦ç½‘ç»œï¼‰
  templatesEnabled: false
};
```

#### 2.2.2 ç¼–è¾‘å™¨åŠ è½½æ–¹å¼

**ä½¿ç”¨ iframe åŠ è½½æœ¬åœ°ç¼–è¾‘å™¨**ï¼š
```typescript
// åˆ›å»º iframe åŠ è½½æœ¬åœ°ç¼–è¾‘å™¨
const iframe = document.createElement('iframe');
iframe.src = browser.runtime.getURL('/drawio-editor/index.html');
iframe.style.cssText = `
  width: 100%;
  height: 100vh;
  border: none;
`;
document.body.appendChild(iframe);
```

**é€šè¿‡ window.postMessage ä¸ç¼–è¾‘å™¨é€šä¿¡**ï¼š
```typescript
// åŠ è½½ XML åˆ°ç¼–è¾‘å™¨
iframe.contentWindow.postMessage({
  action: 'load',
  xml: xmlContent
}, '*');

// ç›‘å¬ç¼–è¾‘å™¨äº‹ä»¶
window.addEventListener('message', (event) => {
  if (event.data.event === 'save') {
    const updatedXml = event.data.xml;
    // å¤„ç†ä¿å­˜çš„ XML
  }
});
```

#### 2.2.3 è·å–ç¼–è¾‘åçš„ XML

**æ–¹æ¡ˆ 1ï¼šç›‘å¬ç¼–è¾‘å™¨çš„ä¿å­˜äº‹ä»¶**
```typescript
// ç›‘å¬ç¼–è¾‘å™¨çš„ä¿å­˜äº‹ä»¶
window.addEventListener('message', (event) => {
  if (event.data.event === 'save') {
    const editedXml = event.data.xml;
    // ä¿å­˜ç¼–è¾‘åçš„ XML
    this.currentXML = editedXml;
  }
});
```

**æ–¹æ¡ˆ 2ï¼šä¸»åŠ¨è¯·æ±‚å¯¼å‡º XML**
```typescript
// ä¸»åŠ¨è¯·æ±‚ç¼–è¾‘å™¨å¯¼å‡ºå½“å‰ XML
async function exportCurrentXML(): Promise<string> {
  return new Promise((resolve, reject) => {
    const handler = (event: MessageEvent) => {
      if (event.data.event === 'export') {
        window.removeEventListener('message', handler);
        resolve(event.data.data);
      }
    };
    
    window.addEventListener('message', handler);
    
    // å‘ç¼–è¾‘å™¨å‘é€å¯¼å‡ºè¯·æ±‚
    iframe.contentWindow.postMessage({
      action: 'export',
      format: 'xml'
    }, '*');
    
    setTimeout(() => {
      window.removeEventListener('message', handler);
      reject(new Error('Export timeout'));
    }, 5000);
  });
}
```

#### 2.2.4 å¤åˆ¶ XML åˆ°å‰ªè´´æ¿

**ä½¿ç”¨ Clipboard API**ï¼š
```typescript
async function copyXMLToClipboard(xml: string): Promise<void> {
  try {
    // ä¼˜å…ˆä½¿ç”¨ç°ä»£ Clipboard API
    await navigator.clipboard.writeText(xml);
    console.log('XML copied to clipboard');
  } catch (error) {
    // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
    const textarea = document.createElement('textarea');
    textarea.value = xml;
    textarea.style.position = 'fixed';
    textarea.style.opacity = '0';
    document.body.appendChild(textarea);
    textarea.select();
    
    try {
      document.execCommand('copy');
      console.log('XML copied to clipboard (fallback)');
    } finally {
      document.body.removeChild(textarea);
    }
  }
}
```

### 2.3 å®Œæ•´å®ç°æ–¹æ¡ˆ

#### 2.3.1 ç¼–è¾‘å™¨æ¸²æŸ“å™¨ï¼ˆæœ¬åœ°åŒ–ç‰ˆæœ¬ï¼‰

```typescript
export class DrawioEditorRenderer {
  private iframe: HTMLIFrameElement | null = null;
  private currentXML: string = '';
  private messageHandler: ((event: MessageEvent) => void) | null = null;

  /**
   * æ¸²æŸ“ç¼–è¾‘å™¨
   */
  async renderEditor(xmlContent: string): Promise<void> {
    // 1. åˆ›å»º iframe åŠ è½½æœ¬åœ°ç¼–è¾‘å™¨
    this.createEditorIframe();
    
    // 2. è®¾ç½®æ¶ˆæ¯ç›‘å¬
    this.setupMessageHandler();
    
    // 3. ç­‰å¾…ç¼–è¾‘å™¨åˆå§‹åŒ–
    await this.waitForEditorReady();
    
    // 4. åŠ è½½ XML æ•°æ®
    await this.loadXMLToEditor(xmlContent);
  }

  /**
   * åˆ›å»ºç¼–è¾‘å™¨ iframeï¼ˆåŠ è½½æœ¬åœ°ç¼–è¾‘å™¨ï¼‰
   */
  private createEditorIframe(): void {
    const iframe = document.createElement('iframe');
    iframe.id = 'drawio-editor-iframe';
    
    // åŠ è½½æœ¬åœ°ç¼–è¾‘å™¨
    iframe.src = browser.runtime.getURL('/drawio-editor/index.html');
    iframe.style.cssText = `
      width: 100%;
      height: calc(100vh - 60px);  /* ä¸ºå·¥å…·æ ç•™å‡ºç©ºé—´ */
      border: none;
      display: block;
    `;
    
    document.body.appendChild(iframe);
    this.iframe = iframe;
  }

  /**
   * è®¾ç½®æ¶ˆæ¯å¤„ç†å™¨
   */
  private setupMessageHandler(): void {
    this.messageHandler = (event: MessageEvent) => {
      // åªæ¥å—æ¥è‡ªæœ¬åœ° iframe çš„æ¶ˆæ¯
      if (event.source !== this.iframe?.contentWindow) {
        return;
      }

      const msg = event.data;
      
      switch (msg.event) {
        case 'init':
          console.log('Editor initialized');
          break;
        case 'save':
          // ç”¨æˆ·ç‚¹å‡»ä¿å­˜æ—¶ï¼Œæ›´æ–°å½“å‰ XML
          this.currentXML = msg.xml;
          console.log('XML saved');
          break;
        case 'export':
          // å¯¼å‡ºå®Œæˆ
          this.currentXML = msg.data;
          break;
      }
    };

    window.addEventListener('message', this.messageHandler);
  }

  /**
   * ç­‰å¾…ç¼–è¾‘å™¨å°±ç»ª
   */
  private async waitForEditorReady(): Promise<void> {
    return new Promise((resolve, reject) => {
      const timeout = setTimeout(() => {
        reject(new Error('Editor initialization timeout'));
      }, 10000);

      const handler = (event: MessageEvent) => {
        if (event.data.event === 'init') {
          clearTimeout(timeout);
          window.removeEventListener('message', handler);
          resolve();
        }
      };

      window.addEventListener('message', handler);
    });
  }

  /**
   * åŠ è½½ XML åˆ°ç¼–è¾‘å™¨
   */
  private async loadXMLToEditor(xml: string): Promise<void> {
    if (!this.iframe?.contentWindow) {
      throw new Error('Editor iframe not ready');
    }

    this.currentXML = xml;
    
    this.iframe.contentWindow.postMessage({
      action: 'load',
      xml: xml
    }, '*');
  }

  /**
   * å¯¼å‡ºå½“å‰ XMLï¼ˆç”¨äºå¤åˆ¶åŠŸèƒ½ï¼‰
   */
  async exportXML(): Promise<string> {
    return new Promise((resolve, reject) => {
      if (!this.iframe?.contentWindow) {
        reject(new Error('Editor not initialized'));
        return;
      }

      const exportHandler = (event: MessageEvent) => {
        if (event.source !== this.iframe?.contentWindow) return;
        
        if (event.data.event === 'export') {
          window.removeEventListener('message', exportHandler);
          this.currentXML = event.data.data;
          resolve(event.data.data);
        }
      };

      window.addEventListener('message', exportHandler);

      // è¯·æ±‚å¯¼å‡º
      this.iframe.contentWindow.postMessage({
        action: 'export',
        format: 'xml'
      }, '*');

      // è®¾ç½®è¶…æ—¶
      setTimeout(() => {
        window.removeEventListener('message', exportHandler);
        reject(new Error('Export timeout'));
      }, 10000);
    });
  }

  /**
   * æ¸…ç†èµ„æº
   */
  destroy(): void {
    if (this.messageHandler) {
      window.removeEventListener('message', this.messageHandler);
    }
    if (this.iframe) {
      this.iframe.remove();
    }
  }
}
```

#### 2.3.2 å·¥å…·æ å®ç°ï¼ˆåŒ…å«å¤åˆ¶ XML åŠŸèƒ½ï¼‰

```typescript
export class EditorToolbar {
  private toolbar: HTMLElement | null = null;
  private onCopyXML?: () => Promise<string>;

  /**
   * åˆ›å»ºå·¥å…·æ 
   */
  create(options: { onCopyXML: () => Promise<string> }): void {
    this.onCopyXML = options.onCopyXML;

    const toolbar = document.createElement('div');
    toolbar.id = 'drawio-editor-toolbar';
    toolbar.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: #2c3e50;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 10000;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    `;

    toolbar.innerHTML = `
      <div style="display: flex; align-items: center; gap: 15px;">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="white">
          <path d="M16 2L2 9v14l14 7 14-7V9L16 2z"/>
        </svg>
        <span style="font-size: 18px; font-weight: 600;">Draw.io Editor</span>
        <span style="font-size: 14px; color: #95a5a6;">
          ç¼–è¾‘åå¯å¤åˆ¶ XML
        </span>
      </div>
      <div style="display: flex; gap: 10px;">
        <button id="copy-xml-btn" style="
          padding: 10px 20px;
          background: #3498db;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
          font-weight: 500;
          transition: background 0.2s;
        ">
          ğŸ“‹ å¤åˆ¶ç¼–è¾‘åçš„ XML
        </button>
        <button id="view-mode-btn" style="
          padding: 10px 20px;
          background: #95a5a6;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
          font-weight: 500;
          transition: background 0.2s;
        ">
          ğŸ‘ï¸ åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼
        </button>
      </div>
    `;

    document.body.appendChild(toolbar);
    this.toolbar = toolbar;

    // å¤åˆ¶ XML æŒ‰é’®
    const copyBtn = toolbar.querySelector('#copy-xml-btn') as HTMLButtonElement;
    copyBtn.addEventListener('click', () => this.handleCopyXML());
    copyBtn.addEventListener('mouseenter', () => {
      copyBtn.style.background = '#2980b9';
    });
    copyBtn.addEventListener('mouseleave', () => {
      copyBtn.style.background = '#3498db';
    });

    // åˆ‡æ¢æ¨¡å¼æŒ‰é’®
    const viewBtn = toolbar.querySelector('#view-mode-btn') as HTMLButtonElement;
    viewBtn.addEventListener('click', () => this.handleSwitchToViewer());
    viewBtn.addEventListener('mouseenter', () => {
      viewBtn.style.background = '#7f8c8d';
    });
    viewBtn.addEventListener('mouseleave', () => {
      viewBtn.style.background = '#95a5a6';
    });
  }

  /**
   * å¤„ç†å¤åˆ¶ XMLï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
   */
  private async handleCopyXML(): Promise<void> {
    if (!this.onCopyXML) return;

    const copyBtn = document.querySelector('#copy-xml-btn') as HTMLButtonElement;
    const originalText = copyBtn.textContent;

    try {
      copyBtn.textContent = 'â³ å¯¼å‡ºä¸­...';
      copyBtn.disabled = true;

      // 1. ä»ç¼–è¾‘å™¨å¯¼å‡ºå½“å‰ XML
      const xml = await this.onCopyXML();

      // 2. å¤åˆ¶åˆ°å‰ªè´´æ¿
      await this.copyToClipboard(xml);

      // 3. æ˜¾ç¤ºæˆåŠŸæç¤º
      copyBtn.textContent = 'âœ… å·²å¤åˆ¶!';
      copyBtn.style.background = '#27ae60';

      this.showNotification('ç¼–è¾‘åçš„ XML å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');

      // 2ç§’åæ¢å¤
      setTimeout(() => {
        copyBtn.textContent = originalText;
        copyBtn.style.background = '#3498db';
        copyBtn.disabled = false;
      }, 2000);

    } catch (error) {
      console.error('Failed to copy XML:', error);
      copyBtn.textContent = 'âŒ å¤åˆ¶å¤±è´¥';
      copyBtn.style.background = '#e74c3c';

      this.showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');

      setTimeout(() => {
        copyBtn.textContent = originalText;
        copyBtn.style.background = '#3498db';
        copyBtn.disabled = false;
      }, 2000);
    }
  }

  /**
   * å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ˆåŒ…å«é™çº§æ–¹æ¡ˆï¼‰
   */
  private async copyToClipboard(text: string): Promise<void> {
    try {
      // ä¼˜å…ˆä½¿ç”¨ç°ä»£ Clipboard API
      await navigator.clipboard.writeText(text);
    } catch (error) {
      // é™çº§åˆ°ä¼ ç»Ÿæ–¹æ³•
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      
      try {
        const successful = document.execCommand('copy');
        if (!successful) {
          throw new Error('execCommand failed');
        }
      } finally {
        document.body.removeChild(textarea);
      }
    }
  }

  /**
   * åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼
   */
  private handleSwitchToViewer(): void {
    if (confirm('åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼å°†ä¸¢å¤±æœªä¿å­˜çš„ç¼–è¾‘ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ')) {
      window.dispatchEvent(new CustomEvent('drawio-switch-mode', {
        detail: { mode: 'viewer' }
      }));
    }
  }

  /**
   * æ˜¾ç¤ºé€šçŸ¥
   */
  private showNotification(message: string, type: 'success' | 'error'): void {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 80px;
      right: 20px;
      padding: 15px 20px;
      background: ${type === 'success' ? '#27ae60' : '#e74c3c'};
      color: white;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 10001;
      font-size: 14px;
      animation: slideIn 0.3s ease-out;
    `;
    notification.textContent = message;

    document.body.appendChild(notification);

    setTimeout(() => {
      notification.style.animation = 'slideOut 0.3s ease-out';
      setTimeout(() => notification.remove(), 300);
    }, 3000);
  }

  /**
   * é”€æ¯å·¥å…·æ 
   */
  destroy(): void {
    if (this.toolbar) {
      this.toolbar.remove();
      this.toolbar = null;
    }
  }
}
```

#### 2.3.3 æ¨¡å¼åˆ‡æ¢æœºåˆ¶

åœ¨å½“å‰çš„ Viewer æ¨¡å¼åŸºç¡€ä¸Šï¼Œæ·»åŠ ç¼–è¾‘å™¨æ¨¡å¼ï¼š

```typescript
enum RenderMode {
  VIEWER = 'viewer',    // å½“å‰çš„åªè¯»é¢„è§ˆæ¨¡å¼
  EDITOR = 'editor'     // æ–°å¢çš„ç¼–è¾‘å™¨æ¨¡å¼
}

interface RenderOptions {
  xmlContent: string;
  mode: RenderMode;
  onSave?: (xml: string) => void;
  onExport?: (xml: string) => void;
}
```

#### 2.3.2 ç¼–è¾‘å™¨é›†æˆå®ç°

**æ ¸å¿ƒç±»è®¾è®¡**:
```typescript
export class DrawioEditorRenderer {
  private iframe: HTMLIFrameElement | null = null;
  private currentXML: string = '';
  private messageHandler: ((event: MessageEvent) => void) | null = null;

  /**
   * æ¸²æŸ“ç¼–è¾‘å™¨
   */
  async renderEditor(options: RenderOptions): Promise<void> {
    // 1. åˆ›å»º iframe å®¹å™¨
    this.createEditorIframe();
    
    // 2. è®¾ç½®æ¶ˆæ¯ç›‘å¬
    this.setupMessageHandler();
    
    // 3. ç­‰å¾…ç¼–è¾‘å™¨åˆå§‹åŒ–
    await this.waitForEditorReady();
    
    // 4. åŠ è½½ XML æ•°æ®
    await this.loadXMLToEditor(options.xmlContent);
    
    // 5. æ˜¾ç¤ºå·¥å…·æ ï¼ˆå¤åˆ¶æŒ‰é’®ç­‰ï¼‰
    this.showEditorToolbar();
  }

  /**
   * åˆ›å»ºç¼–è¾‘å™¨ iframe
   */
  private createEditorIframe(): void {
    const iframe = document.createElement('iframe');
    iframe.id = 'drawio-editor-iframe';
    
    // é…ç½® URL å‚æ•°
    const params = new URLSearchParams({
      embed: '1',           // å¯ç”¨åµŒå…¥æ¨¡å¼
      proto: 'json',        // ä½¿ç”¨ JSON åè®®
      spin: '1',            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
      ui: 'atlas',          // ä½¿ç”¨ atlas UI ä¸»é¢˜
      libraries: '1',       // å¯ç”¨å›¾å½¢åº“
      saveAndExit: '0',     // éšè—"ä¿å­˜å¹¶é€€å‡º"æŒ‰é’®
      noSaveBtn: '1',       // éšè—é»˜è®¤ä¿å­˜æŒ‰é’®
      noExitBtn: '0'        // æ˜¾ç¤ºé€€å‡ºæŒ‰é’®
    });
    
    iframe.src = `https://embed.diagrams.net/?${params.toString()}`;
    iframe.style.cssText = `
      width: 100%;
      height: calc(100vh - 60px);  /* ä¸ºå·¥å…·æ ç•™å‡ºç©ºé—´ */
      border: none;
      display: block;
    `;
    
    document.body.appendChild(iframe);
    this.iframe = iframe;
  }

  /**
   * è®¾ç½®æ¶ˆæ¯å¤„ç†å™¨
   */
  private setupMessageHandler(): void {
    this.messageHandler = (event: MessageEvent) => {
      // å®‰å…¨æ£€æŸ¥ï¼šåªæ¥å—æ¥è‡ª diagrams.net çš„æ¶ˆæ¯
      if (event.origin !== 'https://embed.diagrams.net') {
        return;
      }

      try {
        const msg = JSON.parse(event.data);
        
        switch (msg.event) {
          case 'init':
            this.handleInit();
            break;
          case 'load':
            this.handleLoad(msg);
            break;
          case 'save':
            this.handleSave(msg);
            break;
          case 'export':
            this.handleExport(msg);
            break;
          case 'exit':
            this.handleExit();
            break;
        }
      } catch (error) {
        console.error('Failed to parse message:', error);
      }
    };

    window.addEventListener('message', this.messageHandler);
  }

  /**
   * åŠ è½½ XML åˆ°ç¼–è¾‘å™¨
   */
  private async loadXMLToEditor(xml: string): Promise<void> {
    if (!this.iframe?.contentWindow) {
      throw new Error('Editor iframe not ready');
    }

    this.currentXML = xml;
    
    const message = JSON.stringify({
      action: 'load',
      xml: xml,
      autosave: 0  // ç¦ç”¨è‡ªåŠ¨ä¿å­˜
    });

    this.iframe.contentWindow.postMessage(message, 'https://embed.diagrams.net');
  }

  /**
   * å¯¼å‡ºå½“å‰ XML
   */
  async exportXML(): Promise<string> {
    return new Promise((resolve, reject) => {
      if (!this.iframe?.contentWindow) {
        reject(new Error('Editor not initialized'));
        return;
      }

      // è®¾ç½®ä¸´æ—¶å¤„ç†å™¨ç­‰å¾…å¯¼å‡ºç»“æœ
      const exportHandler = (event: MessageEvent) => {
        if (event.origin !== 'https://embed.diagrams.net') return;
        
        try {
          const msg = JSON.parse(event.data);
          if (msg.event === 'export') {
            window.removeEventListener('message', exportHandler);
            this.currentXML = msg.data;
            resolve(msg.data);
          }
        } catch (error) {
          reject(error);
        }
      };

      window.addEventListener('message', exportHandler);

      // è¯·æ±‚å¯¼å‡º
      const message = JSON.stringify({
        action: 'export',
        format: 'xml'
      });

      this.iframe.contentWindow.postMessage(message, 'https://embed.diagrams.net');

      // è®¾ç½®è¶…æ—¶
      setTimeout(() => {
        window.removeEventListener('message', exportHandler);
        reject(new Error('Export timeout'));
      }, 10000);
    });
  }

  /**
   * æ¸…ç†èµ„æº
   */
  destroy(): void {
    if (this.messageHandler) {
      window.removeEventListener('message', this.messageHandler);
    }
    if (this.iframe) {
      this.iframe.remove();
    }
  }
}
```

#### 2.3.3 å·¥å…·æ å®ç°

åœ¨ç¼–è¾‘å™¨ä¸Šæ–¹æ·»åŠ å·¥å…·æ ï¼Œæä¾›å¤åˆ¶ XML åŠŸèƒ½ï¼š

```typescript
export class EditorToolbar {
  private toolbar: HTMLElement | null = null;
  private onCopyXML?: () => Promise<string>;

  /**
   * åˆ›å»ºå·¥å…·æ 
   */
  create(options: { onCopyXML: () => Promise<string> }): void {
    this.onCopyXML = options.onCopyXML;

    const toolbar = document.createElement('div');
    toolbar.id = 'drawio-editor-toolbar';
    toolbar.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: #2c3e50;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 10000;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    `;

    toolbar.innerHTML = `
      <div style="display: flex; align-items: center; gap: 15px;">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="white">
          <path d="M16 2L2 9v14l14 7 14-7V9L16 2z"/>
        </svg>
        <span style="font-size: 18px; font-weight: 600;">Draw.io Editor</span>
        <span style="font-size: 14px; color: #95a5a6;">
          (åªè¯»æ¨¡å¼ - ç¼–è¾‘åå¯å¤åˆ¶ XML)
        </span>
      </div>
      <div style="display: flex; gap: 10px;">
        <button id="copy-xml-btn" style="
          padding: 10px 20px;
          background: #3498db;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
          font-weight: 500;
          transition: background 0.2s;
        ">
          ğŸ“‹ å¤åˆ¶ XML
        </button>
        <button id="view-mode-btn" style="
          padding: 10px 20px;
          background: #95a5a6;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
          font-weight: 500;
          transition: background 0.2s;
        ">
          ğŸ‘ï¸ åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼
        </button>
      </div>
    `;

    // æ·»åŠ æŒ‰é’®äº‹ä»¶
    document.body.appendChild(toolbar);
    this.toolbar = toolbar;

    // å¤åˆ¶ XML æŒ‰é’®
    const copyBtn = toolbar.querySelector('#copy-xml-btn') as HTMLButtonElement;
    copyBtn.addEventListener('click', () => this.handleCopyXML());
    copyBtn.addEventListener('mouseenter', () => {
      copyBtn.style.background = '#2980b9';
    });
    copyBtn.addEventListener('mouseleave', () => {
      copyBtn.style.background = '#3498db';
    });

    // åˆ‡æ¢æ¨¡å¼æŒ‰é’®
    const viewBtn = toolbar.querySelector('#view-mode-btn') as HTMLButtonElement;
    viewBtn.addEventListener('click', () => this.handleSwitchToViewer());
    viewBtn.addEventListener('mouseenter', () => {
      viewBtn.style.background = '#7f8c8d';
    });
    viewBtn.addEventListener('mouseleave', () => {
      viewBtn.style.background = '#95a5a6';
    });
  }

  /**
   * å¤„ç†å¤åˆ¶ XML
   */
  private async handleCopyXML(): Promise<void> {
    if (!this.onCopyXML) return;

    const copyBtn = document.querySelector('#copy-xml-btn') as HTMLButtonElement;
    const originalText = copyBtn.textContent;

    try {
      copyBtn.textContent = 'â³ å¯¼å‡ºä¸­...';
      copyBtn.disabled = true;

      // è·å–å½“å‰ XML
      const xml = await this.onCopyXML();

      // å¤åˆ¶åˆ°å‰ªè´´æ¿
      await navigator.clipboard.writeText(xml);

      // æ˜¾ç¤ºæˆåŠŸæç¤º
      copyBtn.textContent = 'âœ… å·²å¤åˆ¶!';
      copyBtn.style.background = '#27ae60';

      // æ˜¾ç¤ºé€šçŸ¥
      this.showNotification('XML å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');

      // 2ç§’åæ¢å¤
      setTimeout(() => {
        copyBtn.textContent = originalText;
        copyBtn.style.background = '#3498db';
        copyBtn.disabled = false;
      }, 2000);

    } catch (error) {
      console.error('Failed to copy XML:', error);
      copyBtn.textContent = 'âŒ å¤åˆ¶å¤±è´¥';
      copyBtn.style.background = '#e74c3c';

      this.showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');

      setTimeout(() => {
        copyBtn.textContent = originalText;
        copyBtn.style.background = '#3498db';
        copyBtn.disabled = false;
      }, 2000);
    }
  }

  /**
   * åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼
   */
  private handleSwitchToViewer(): void {
    if (confirm('åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼å°†ä¸¢å¤±æœªä¿å­˜çš„ç¼–è¾‘ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ')) {
      // è§¦å‘æ¨¡å¼åˆ‡æ¢äº‹ä»¶
      window.dispatchEvent(new CustomEvent('drawio-switch-mode', {
        detail: { mode: 'viewer' }
      }));
    }
  }

  /**
   * æ˜¾ç¤ºé€šçŸ¥
   */
  private showNotification(message: string, type: 'success' | 'error'): void {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 80px;
      right: 20px;
      padding: 15px 20px;
      background: ${type === 'success' ? '#27ae60' : '#e74c3c'};
      color: white;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 10001;
      font-size: 14px;
      animation: slideIn 0.3s ease-out;
    `;
    notification.textContent = message;

    document.body.appendChild(notification);

    setTimeout(() => {
      notification.style.animation = 'slideOut 0.3s ease-out';
      setTimeout(() => notification.remove(), 300);
    }, 3000);
  }

  /**
   * é”€æ¯å·¥å…·æ 
   */
  destroy(): void {
    if (this.toolbar) {
      this.toolbar.remove();
      this.toolbar = null;
    }
  }
}
```

#### 2.3.4 æ¨¡å¼ç®¡ç†å™¨

ç»Ÿä¸€ç®¡ç† Viewer å’Œ Editor ä¸¤ç§æ¨¡å¼ï¼š

```typescript
export class DrawioModeManager {
  private currentMode: RenderMode = RenderMode.VIEWER;
  private viewerRenderer: DrawioRenderer | null = null;
  private editorRenderer: DrawioEditorRenderer | null = null;
  private toolbar: EditorToolbar | null = null;
  private xmlContent: string = '';

  /**
   * åˆå§‹åŒ–å¹¶æ¸²æŸ“
   */
  async initialize(xmlContent: string, initialMode: RenderMode = RenderMode.VIEWER): Promise<void> {
    this.xmlContent = xmlContent;
    await this.switchMode(initialMode);

    // ç›‘å¬æ¨¡å¼åˆ‡æ¢äº‹ä»¶
    window.addEventListener('drawio-switch-mode', (event: Event) => {
      const customEvent = event as CustomEvent;
      this.switchMode(customEvent.detail.mode);
    });
  }

  /**
   * åˆ‡æ¢æ¨¡å¼
   */
  async switchMode(mode: RenderMode): Promise<void> {
    // æ¸…ç†å½“å‰æ¨¡å¼
    this.cleanup();

    this.currentMode = mode;

    if (mode === RenderMode.VIEWER) {
      await this.renderViewer();
    } else {
      await this.renderEditor();
    }
  }

  /**
   * æ¸²æŸ“é¢„è§ˆæ¨¡å¼
   */
  private async renderViewer(): Promise<void> {
    this.viewerRenderer = createRenderer();
    await this.viewerRenderer.render({
      xmlContent: this.xmlContent
    });

    // æ·»åŠ åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼çš„æŒ‰é’®
    this.addSwitchButton('editor');
  }

  /**
   * æ¸²æŸ“ç¼–è¾‘æ¨¡å¼
   */
  private async renderEditor(): Promise<void> {
    this.editorRenderer = new DrawioEditorRenderer();
    await this.editorRenderer.renderEditor({
      xmlContent: this.xmlContent,
      mode: RenderMode.EDITOR
    });

    // åˆ›å»ºå·¥å…·æ 
    this.toolbar = new EditorToolbar();
    this.toolbar.create({
      onCopyXML: async () => {
        if (!this.editorRenderer) {
          throw new Error('Editor not initialized');
        }
        const xml = await this.editorRenderer.exportXML();
        this.xmlContent = xml;  // æ›´æ–°å½“å‰ XML
        return xml;
      }
    });
  }

  /**
   * æ·»åŠ æ¨¡å¼åˆ‡æ¢æŒ‰é’®
   */
  private addSwitchButton(targetMode: RenderMode): void {
    const button = document.createElement('button');
    button.id = 'mode-switch-btn';
    button.textContent = targetMode === 'editor' ? 'âœï¸ ç¼–è¾‘æ¨¡å¼' : 'ğŸ‘ï¸ é¢„è§ˆæ¨¡å¼';
    button.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 24px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 9999;
      transition: background 0.2s;
    `;

    button.addEventListener('click', () => {
      this.switchMode(targetMode);
    });

    button.addEventListener('mouseenter', () => {
      button.style.background = '#2980b9';
    });

    button.addEventListener('mouseleave', () => {
      button.style.background = '#3498db';
    });

    document.body.appendChild(button);
  }

  /**
   * æ¸…ç†å½“å‰æ¨¡å¼
   */
  private cleanup(): void {
    // æ¸…ç† viewer
    if (this.viewerRenderer) {
      // DrawioRenderer æ²¡æœ‰ destroy æ–¹æ³•ï¼Œç›´æ¥æ¸…ç©º body
      document.body.innerHTML = '';
      this.viewerRenderer = null;
    }

    // æ¸…ç† editor
    if (this.editorRenderer) {
      this.editorRenderer.destroy();
      this.editorRenderer = null;
    }

    // æ¸…ç† toolbar
    if (this.toolbar) {
      this.toolbar.destroy();
      this.toolbar = null;
    }

    // ç§»é™¤åˆ‡æ¢æŒ‰é’®
    const switchBtn = document.getElementById('mode-switch-btn');
    if (switchBtn) {
      switchBtn.remove();
    }
  }
}
```

### 2.4 Content Script é›†æˆ

ä¿®æ”¹ `entrypoints/content.ts` ä»¥æ”¯æŒæ–°çš„ç¼–è¾‘å™¨æ¨¡å¼ï¼š

```typescript
import { DrawioModeManager, RenderMode } from '@/utils/modeManager';

// åœ¨ processPage å‡½æ•°ä¸­
async function processPage(): Promise<void> {
  try {
    // ... ç°æœ‰çš„ XML æå–å’ŒéªŒè¯ä»£ç  ...

    // åˆ›å»ºæ¨¡å¼ç®¡ç†å™¨
    const modeManager = new DrawioModeManager();
    
    // é»˜è®¤ä½¿ç”¨é¢„è§ˆæ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼
    await modeManager.initialize(xmlContent, RenderMode.VIEWER);

    console.log('âœ“ Draw.io diagram initialized with mode switching support');
  } catch (error) {
    console.error('Error processing page:', error);
  }
}
```

### 2.5 æƒé™é…ç½®ï¼ˆæœ¬åœ°åŒ–æ–¹æ¡ˆï¼‰

æ›´æ–° `wxt.config.ts` ä¸­çš„ manifest é…ç½®ï¼š

```typescript
export default defineConfig({
  manifest: {
    permissions: [
      // Clipboard API åœ¨ç”¨æˆ·äº¤äº’æ—¶ä¸éœ€è¦é¢å¤–æƒé™
    ],
    // ä¸éœ€è¦ host_permissionsï¼Œå› ä¸ºæ‰€æœ‰èµ„æºéƒ½æ˜¯æœ¬åœ°çš„
    content_security_policy: {
      extension_pages: "script-src 'self'; object-src 'self'; frame-src 'self';"
    },
    web_accessible_resources: [
      {
        resources: ['drawio-editor/*'],  // å…è®¸è®¿é—®æœ¬åœ°ç¼–è¾‘å™¨èµ„æº
        matches: ['<all_urls>']
      }
    ]
  }
});
```

**é‡è¦è¯´æ˜**ï¼š

1. **æ— éœ€å¤–éƒ¨æƒé™**ï¼š
   - ä¸éœ€è¦ `host_permissions`ï¼Œå› ä¸ºæ‰€æœ‰èµ„æºéƒ½æ‰“åŒ…åœ¨æ‰©å±•ä¸­
   - æ‰€æœ‰æ•°æ®å¤„ç†å®Œå…¨åœ¨æœ¬åœ°ï¼Œæ— å¤–éƒ¨ç½‘ç»œè¯·æ±‚

2. **CSP é…ç½®**ï¼š
   - `frame-src 'self'` åªå…è®¸åŠ è½½æ‰©å±•å†…éƒ¨çš„ iframe
   - å®Œå…¨é˜»æ­¢å¤–éƒ¨èµ„æºåŠ è½½ï¼Œç¡®ä¿æ•°æ®å®‰å…¨

3. **Web Accessible Resources**ï¼š
   - å…è®¸ content script è®¿é—®æ‰“åŒ…çš„ draw.io ç¼–è¾‘å™¨èµ„æº
   - è¿™æ˜¯åŠ è½½æœ¬åœ°ç¼–è¾‘å™¨çš„å¿…è¦é…ç½®

4. **Clipboard API**ï¼š
   - Manifest V3 ä¸­ï¼Œç”¨æˆ·äº¤äº’è§¦å‘çš„ `navigator.clipboard.writeText()` ä¸éœ€è¦é¢å¤–æƒé™
   - æˆ‘ä»¬çš„å®ç°æ˜¯åœ¨ç”¨æˆ·ç‚¹å‡»"å¤åˆ¶ XML"æŒ‰é’®æ—¶è§¦å‘ï¼Œå±äºç”¨æˆ·äº¤äº’

## 3. ç”¨æˆ·ä½“éªŒè®¾è®¡

### 3.1 å·¥ä½œæµç¨‹

```
ç”¨æˆ·è®¿é—® .drawio æ–‡ä»¶
       â†“
æ‰©å±•æ£€æµ‹å¹¶æ˜¾ç¤ºé¢„è§ˆæ¨¡å¼
       â†“
ç”¨æˆ·ç‚¹å‡»"ç¼–è¾‘æ¨¡å¼"æŒ‰é’®
       â†“
åˆ‡æ¢åˆ°ç¼–è¾‘å™¨æ¨¡å¼ï¼ˆiframe åŠ è½½ draw.ioï¼‰
       â†“
ç”¨æˆ·ç¼–è¾‘å›¾è¡¨
       â†“
ç”¨æˆ·ç‚¹å‡»"å¤åˆ¶ XML"æŒ‰é’®
       â†“
å¯¼å‡ºå½“å‰ XML å¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿
       â†“
æ˜¾ç¤ºæˆåŠŸæç¤º
       â†“
ç”¨æˆ·å¯ä»¥ç²˜è´´ XML åˆ°å…¶ä»–åœ°æ–¹ä¿å­˜
```

### 3.2 ç•Œé¢è®¾è®¡

**é¢„è§ˆæ¨¡å¼**:
- å³ä¸Šè§’æ˜¾ç¤º"âœï¸ ç¼–è¾‘æ¨¡å¼"æŒ‰é’®
- ç®€æ´çš„é¢„è§ˆç•Œé¢

**ç¼–è¾‘æ¨¡å¼**:
- é¡¶éƒ¨å·¥å…·æ ï¼ˆæ·±è‰²èƒŒæ™¯ï¼‰
  - å·¦ä¾§ï¼šLogo + æ ‡é¢˜ + æç¤ºæ–‡å­—
  - å³ä¾§ï¼šå¤åˆ¶ XML æŒ‰é’® + åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼æŒ‰é’®
- ä¸‹æ–¹ï¼šå®Œæ•´çš„ draw.io ç¼–è¾‘å™¨ï¼ˆiframeï¼‰
- å¤åˆ¶æˆåŠŸåæ˜¾ç¤ºæµ®åŠ¨é€šçŸ¥

### 3.3 ç”¨æˆ·æç¤º

åœ¨ç¼–è¾‘å™¨æ¨¡å¼ä¸‹æ˜¾ç¤ºæ˜ç¡®çš„æç¤ºï¼š
- "åªè¯»æ¨¡å¼ - ç¼–è¾‘åå¯å¤åˆ¶ XML"
- å¤åˆ¶æˆåŠŸï¼š"XML å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼"
- åˆ‡æ¢æ¨¡å¼ç¡®è®¤ï¼š"åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼å°†ä¸¢å¤±æœªä¿å­˜çš„ç¼–è¾‘ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ"

## 4. å®‰å…¨æ€§è€ƒè™‘

### 4.1 CSP é…ç½®
```javascript
content_security_policy: {
  extension_pages: "script-src 'self'; frame-src https://embed.diagrams.net;"
}
```

### 4.2 æ¶ˆæ¯éªŒè¯
```javascript
// ä¸¥æ ¼éªŒè¯æ¶ˆæ¯æ¥æº
if (event.origin !== 'https://embed.diagrams.net') {
  return;  // æ‹’ç»éå®˜æ–¹æ¥æºçš„æ¶ˆæ¯
}
```

### 4.3 æ•°æ®éš”ç¦»
- æ‰€æœ‰æ•°æ®å¤„ç†åœ¨å®¢æˆ·ç«¯å®Œæˆ
- ä¸å‘é€ä»»ä½•æ•°æ®åˆ°å¤–éƒ¨æœåŠ¡å™¨
- XML æ•°æ®ä»…åœ¨å†…å­˜ä¸­ä¼ é€’

## 5. æ€§èƒ½ä¼˜åŒ–

### 5.1 å»¶è¿ŸåŠ è½½
- é»˜è®¤ä½¿ç”¨è½»é‡çº§çš„ Viewer æ¨¡å¼
- ä»…åœ¨ç”¨æˆ·åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼æ—¶æ‰åŠ è½½ iframe

### 5.2 èµ„æºç®¡ç†
- åˆ‡æ¢æ¨¡å¼æ—¶æ­£ç¡®æ¸…ç†èµ„æº
- ä½¿ç”¨äº‹ä»¶å§”æ‰˜å‡å°‘å†…å­˜å ç”¨

### 5.3 ç¼“å­˜ç­–ç•¥
- ç¼“å­˜å½“å‰ç¼–è¾‘çš„ XML
- é¿å…é‡å¤å¯¼å‡º

## 6. å®æ–½è®¡åˆ’ï¼ˆæœ¬åœ°åŒ–æ–¹æ¡ˆï¼‰

### 6.1 å¼€å‘é˜¶æ®µ

**Phase 1: è·å–å’Œé…ç½® Draw.io ç¼–è¾‘å™¨** (1-2å¤©)
- ä» draw.io GitHub ä»“åº“ä¸‹è½½ `src/main/webapp` ç›®å½•
- é…ç½® `PreConfig.js` ç¦ç”¨æ‰€æœ‰å¤–éƒ¨è¿æ¥
- ç²¾ç®€ä¸éœ€è¦çš„æ–‡ä»¶ï¼ˆåœ¨çº¿å­˜å‚¨ã€æ¨¡æ¿ç­‰ï¼‰
- æµ‹è¯•ç¼–è¾‘å™¨å¯ä»¥ç‹¬ç«‹è¿è¡Œ

**Phase 2: é›†æˆåˆ°æµè§ˆå™¨æ‰©å±•** (2-3å¤©)
- å°†ç¼–è¾‘å™¨æ–‡ä»¶æ‰“åŒ…åˆ°æ‰©å±•çš„ `drawio-editor/` ç›®å½•
- å®ç° `DrawioEditorRenderer` ç±»åŠ è½½æœ¬åœ°ç¼–è¾‘å™¨
- å®ç° postMessage é€šä¿¡åè®®
- åŸºæœ¬çš„ XML åŠ è½½å’Œå¯¼å‡ºåŠŸèƒ½

**Phase 3: å·¥å…·æ å’Œäº¤äº’** (1-2å¤©)
- å®ç° `EditorToolbar` ç»„ä»¶
- å®ç°å¤åˆ¶åˆ°å‰ªè´´æ¿åŠŸèƒ½
- æ·»åŠ ç”¨æˆ·æç¤ºå’Œé€šçŸ¥
- ä¼˜åŒ–ç¼–è¾‘å™¨ UI

**Phase 4: æ¨¡å¼ç®¡ç†å’Œä¼˜åŒ–** (1-2å¤©)
- å®ç° `DrawioModeManager`
- å®ç° Viewer/Editor æ¨¡å¼åˆ‡æ¢
- ä¼˜åŒ–åŠ è½½æ€§èƒ½ï¼ˆå»¶è¿ŸåŠ è½½ç¼–è¾‘å™¨ï¼‰
- æµ‹è¯•å’Œä¼˜åŒ–

**Phase 5: æµ‹è¯•å’Œå‘å¸ƒ** (1-2å¤©)
- è·¨æµè§ˆå™¨æµ‹è¯•
- æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼–è¾‘å™¨æ–‡ä»¶å‹ç¼©ï¼‰
- ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- æ–‡æ¡£æ›´æ–°

> æ³¨ï¼šä»¥ä¸Šä¸ºå¼€å‘ä»»åŠ¡æ¸…å•ï¼Œéä»£ç å®ç°ä¸­çš„ TODO

### 6.2 æµ‹è¯•è®¡åˆ’

**åŠŸèƒ½æµ‹è¯•**:
- âœ… ç¼–è¾‘å™¨æ­£å¸¸åŠ è½½
- âœ… XML æ­£ç¡®å¯¼å…¥åˆ°ç¼–è¾‘å™¨
- âœ… ç¼–è¾‘åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… XML å¯¼å‡ºåŠŸèƒ½æ­£å¸¸
- âœ… å¤åˆ¶åˆ°å‰ªè´´æ¿æˆåŠŸ
- âœ… æ¨¡å¼åˆ‡æ¢æµç•…

**å…¼å®¹æ€§æµ‹è¯•**:
- âœ… Chrome/Edge (Manifest V3)
- âœ… Firefox (Manifest V2/V3)
- âœ… ä¸åŒæ“ä½œç³»ç»Ÿ

**å®‰å…¨æ€§æµ‹è¯•**:
- âœ… CSP é…ç½®æ­£ç¡®
- âœ… æ¶ˆæ¯æ¥æºéªŒè¯
- âœ… æ— æ•°æ®æ³„éœ²

## 7. æ½œåœ¨é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 7.1 é—®é¢˜ï¼šiframe åŠ è½½æ…¢
**è§£å†³æ–¹æ¡ˆ**:
- æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
- ä½¿ç”¨ `spin=1` å‚æ•°å¯ç”¨å®˜æ–¹åŠ è½½æŒ‡ç¤ºå™¨
- é¢„åŠ è½½ iframeï¼ˆå¯é€‰ï¼‰

### 7.2 é—®é¢˜ï¼šå¤§æ–‡ä»¶æ€§èƒ½
**è§£å†³æ–¹æ¡ˆ**:
- å¯¹å¤§æ–‡ä»¶æ˜¾ç¤ºè­¦å‘Š
- æä¾›"ç®€åŒ–æ¨¡å¼"é€‰é¡¹
- ä½¿ç”¨ Web Worker å¤„ç† XMLï¼ˆå¦‚éœ€è¦ï¼‰

### 7.3 é—®é¢˜ï¼šå‰ªè´´æ¿æƒé™
**è§£å†³æ–¹æ¡ˆ**:
- Manifest V3 ä¸­ï¼Œç”¨æˆ·äº¤äº’è§¦å‘çš„ `navigator.clipboard.writeText()` ä¸éœ€è¦é¢å¤–æƒé™
- å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ Clipboard APIï¼Œæä¾›é™çº§æ–¹æ¡ˆï¼š
  ```typescript
  // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿçš„ document.execCommand
  private async copyToClipboardFallback(text: string): Promise<void> {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    textarea.style.position = 'fixed';
    textarea.style.opacity = '0';
    document.body.appendChild(textarea);
    textarea.select();
    
    try {
      const successful = document.execCommand('copy');
      if (!successful) {
        throw new Error('execCommand failed');
      }
    } finally {
      document.body.removeChild(textarea);
    }
  }
  
  // ä¸»å¤åˆ¶å‡½æ•°
  private async copyToClipboard(text: string): Promise<void> {
    try {
      // ä¼˜å…ˆä½¿ç”¨ç°ä»£ Clipboard API
      await navigator.clipboard.writeText(text);
    } catch (error) {
      // é™çº§åˆ°ä¼ ç»Ÿæ–¹æ³•
      await this.copyToClipboardFallback(text);
    }
  }
  ```

### 7.4 é—®é¢˜ï¼šç”¨æˆ·è¯¯æ“ä½œä¸¢å¤±ç¼–è¾‘
**è§£å†³æ–¹æ¡ˆ**:
- åˆ‡æ¢æ¨¡å¼å‰æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
- è€ƒè™‘æ·»åŠ  sessionStorage ä¸´æ—¶ä¿å­˜
- æä¾›"æ¢å¤ä¸Šæ¬¡ç¼–è¾‘"åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

## 8. æœªæ¥æ‰©å±•

### 8.1 çŸ­æœŸæ‰©å±• (v1.1)
- æ”¯æŒå¯¼å‡ºä¸º PNG/SVG
- æ·»åŠ é”®ç›˜å¿«æ·é”®
- æ”¯æŒæš—è‰²ä¸»é¢˜

### 8.2 ä¸­æœŸæ‰©å±• (v1.2)
- æœ¬åœ°å­˜å‚¨è‰ç¨¿
- å†å²ç‰ˆæœ¬ç®¡ç†
- æ‰¹é‡å¤„ç†å¤šä¸ªæ–‡ä»¶

### 8.3 é•¿æœŸæ‰©å±• (v2.0)
- äº‘ç«¯åŒæ­¥ï¼ˆå¯é€‰ï¼‰
- åä½œç¼–è¾‘ï¼ˆå¦‚æœå¯è¡Œï¼‰
- è‡ªå®šä¹‰æ¨¡æ¿åº“

## 9. å‚è€ƒèµ„æ–™

### 9.1 å®˜æ–¹æ–‡æ¡£
- [Draw.io Embed Mode](https://www.drawio.com/doc/faq/embed-mode)
- [Draw.io Embedding Walkthrough](https://www.drawio.com/blog/embedding-walkthrough)
- [Chrome Extension Manifest V3](https://developer.chrome.com/docs/extensions/mv3/)

### 9.2 æˆåŠŸæ¡ˆä¾‹
- [GitLab diagrams.net Integration](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/86206)
- [VS Code Draw.io Extension](https://marketplace.visualstudio.com/items?itemName=hediet.vscode-drawio)
- [MediaWiki DrawioEditor](https://www.mediawiki.org/wiki/Extension:DrawioEditor)

### 9.3 æŠ€æœ¯å‚è€ƒ
- [PostMessage API](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage)
- [Clipboard API](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API)
- [Content Security Policy](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP)

## 10. å…³é”®æŠ€æœ¯éªŒè¯

### 10.1 å·²éªŒè¯çš„æŠ€æœ¯ç‚¹

âœ… **Draw.io Embed Mode**ï¼šå®˜æ–¹æ–‡æ¡£å®Œæ•´ï¼ŒAPI ç¨³å®š
âœ… **PostMessage é€šä¿¡**ï¼šæ ‡å‡† Web APIï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨æ”¯æŒ
âœ… **Clipboard API**ï¼šManifest V3 ä¸­ç”¨æˆ·äº¤äº’åœºæ™¯æ— éœ€é¢å¤–æƒé™
âœ… **Iframe é›†æˆ**ï¼šCSP é…ç½®æ˜ç¡®ï¼Œå¯æ­£å¸¸åŠ è½½
âœ… **è·¨æµè§ˆå™¨å…¼å®¹**ï¼šChromeã€Firefoxã€Edge å‡æ”¯æŒ

### 10.2 æ ¸å¿ƒä»£ç å®Œæ•´æ€§ç¡®è®¤

æ–‡æ¡£ä¸­æä¾›çš„æ‰€æœ‰ä»£ç ç¤ºä¾‹å‡ä¸º**å®Œæ•´å¯è¿è¡Œ**çš„å®ç°ï¼ŒåŒ…æ‹¬ï¼š

1. **DrawioEditorRenderer ç±»**ï¼šå®Œæ•´çš„ç¼–è¾‘å™¨æ¸²æŸ“é€»è¾‘
2. **EditorToolbar ç±»**ï¼šå®Œæ•´çš„å·¥å…·æ å®ç°ï¼ŒåŒ…å«å¤åˆ¶åŠŸèƒ½å’Œé™çº§æ–¹æ¡ˆ
3. **DrawioModeManager ç±»**ï¼šå®Œæ•´çš„æ¨¡å¼ç®¡ç†é€»è¾‘
4. **PostMessage é€šä¿¡**ï¼šå®Œæ•´çš„æ¶ˆæ¯å¤„ç†æµç¨‹
5. **é”™è¯¯å¤„ç†**ï¼šåŒ…å«è¶…æ—¶ã€å¤±è´¥ç­‰å¼‚å¸¸åœºæ™¯å¤„ç†

### 10.3 æ— é—ç•™é—®é¢˜ç¡®è®¤

- âœ… æ—  TODO æ ‡è®°ï¼ˆå¼€å‘ä»»åŠ¡æ¸…å•é™¤å¤–ï¼‰
- âœ… æ— ç®€åŒ–å®ç°æˆ–å‡è®¾å®ç°
- âœ… æ‰€æœ‰å…³é”®æŠ€æœ¯ç‚¹éƒ½æœ‰å®Œæ•´è¯´æ˜
- âœ… æ‰€æœ‰æ½œåœ¨é—®é¢˜éƒ½æœ‰è§£å†³æ–¹æ¡ˆ
- âœ… æƒé™é…ç½®ç»è¿‡éªŒè¯å’Œè¯´æ˜
- âœ… é™çº§æ–¹æ¡ˆå·²æä¾›

## 11. å®æ–½æ­¥éª¤è¯¦è§£

### 11.1 è·å– Draw.io ç¼–è¾‘å™¨æºç 

```bash
# 1. Clone draw.io ä»“åº“
git clone https://github.com/jgraph/drawio.git
cd drawio

# 2. åªä¿ç•™ webapp ç›®å½•
cp -r src/main/webapp ../drawio-editor

# 3. ç²¾ç®€ä¸éœ€è¦çš„æ–‡ä»¶
cd ../drawio-editor
# åˆ é™¤åœ¨çº¿å­˜å‚¨ç›¸å…³æ–‡ä»¶
rm -rf connect/
# åˆ é™¤ä¸éœ€è¦çš„ HTML æ–‡ä»¶
rm dropbox.html github.html gitlab.html onedrive*.html

# 4. ä¿®æ”¹ PreConfig.jsï¼ˆå‚è€ƒ drawio-local é¡¹ç›®ï¼‰
```

### 11.2 æ‰©å±•ç›®å½•ç»“æ„

```
drawio-viewer/
â”œâ”€â”€ drawio-editor/              # æœ¬åœ° draw.io ç¼–è¾‘å™¨ï¼ˆ~5MBï¼‰
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ app.min.js
â”‚   â”‚   â”œâ”€â”€ PreConfig.js       # è‡ªå®šä¹‰é…ç½®
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ mxgraph/
â”‚   â”œâ”€â”€ styles/
â”‚   â”œâ”€â”€ shapes/
â”‚   â””â”€â”€ resources/
â”œâ”€â”€ entrypoints/
â”‚   â”œâ”€â”€ content.ts
â”‚   â””â”€â”€ background.ts
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ renderer.ts            # Viewer æ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ editorRenderer.ts      # Editor æ¸²æŸ“å™¨ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ modeManager.ts         # æ¨¡å¼ç®¡ç†å™¨ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ wxt.config.ts
```

### 11.3 æ‰©å±•å¤§å°ä¼°ç®—

- **Draw.io ç¼–è¾‘å™¨**ï¼š~5MBï¼ˆå‹ç¼©å ~2MBï¼‰
- **å½“å‰æ‰©å±•ä»£ç **ï¼š~100KB
- **æ€»å¤§å°**ï¼š~2.1MBï¼ˆå‹ç¼©åï¼‰

è¿™ä¸ªå¤§å°åœ¨æµè§ˆå™¨æ‰©å±•ä¸­æ˜¯å¯æ¥å—çš„ï¼ˆChrome æ‰©å±•é™åˆ¶ä¸º 128MBï¼‰ã€‚

## 12. æ€»ç»“

è¯¥æ–¹æ¡ˆ**å®Œå…¨å¯è¡Œä¸”æ›´å®‰å…¨**ï¼Œé‡‡ç”¨å®Œå…¨æœ¬åœ°åŒ–å®ç°ã€‚ä¸»è¦ä¼˜åŠ¿ï¼š

âœ… **æ•°æ®å®‰å…¨æ€§æé«˜**ï¼šæ‰€æœ‰æ•°æ®å®Œå…¨åœ¨æœ¬åœ°å¤„ç†ï¼Œä¸å‘é€åˆ°ä»»ä½•å¤–éƒ¨æœåŠ¡å™¨
âœ… **å®Œå…¨ç¦»çº¿**ï¼šæ— éœ€ç½‘ç»œè¿æ¥å³å¯ç¼–è¾‘ï¼Œé€‚åˆä¼ä¸šå†…ç½‘ç¯å¢ƒ
âœ… **æŠ€æœ¯æˆç†Ÿ**ï¼šVS Code æ‰©å±•ï¼ˆ9.4k starsï¼‰å·²éªŒè¯æ­¤æ–¹æ¡ˆçš„å¯è¡Œæ€§
âœ… **ç”¨æˆ·ä½“éªŒå¥½**ï¼šæ— ç¼é›†æˆï¼Œæ“ä½œç®€å•ï¼Œæ”¯æŒæ¨¡å¼åˆ‡æ¢
âœ… **æ€§èƒ½ä¼˜ç§€**ï¼šæœ¬åœ°åŠ è½½ï¼Œæ— ç½‘ç»œå»¶è¿Ÿ
âœ… **ç»´æŠ¤æˆæœ¬ä½**ï¼šdraw.io ç¼–è¾‘å™¨ç¨³å®šï¼Œæ— éœ€é¢‘ç¹æ›´æ–°
âœ… **å…¼å®¹æ€§å¥½**ï¼šæ”¯æŒæ‰€æœ‰ä¸»æµæµè§ˆå™¨å’Œ Manifest V3

**é¢„è®¡å¼€å‘å‘¨æœŸ**ï¼š1.5-2å‘¨
**æŠ€æœ¯éš¾åº¦**ï¼šä¸­ç­‰
**æˆåŠŸæ¦‚ç‡**ï¼š98%+ï¼ˆVS Code æ‰©å±•å·²éªŒè¯ï¼‰
**é£é™©ç­‰çº§**ï¼šæä½
**æ‰©å±•å¤§å°**ï¼š~2MBï¼ˆå‹ç¼©åï¼‰

**å»ºè®®**ï¼šç«‹å³å¼€å§‹å®æ–½ï¼ŒæŒ‰ç…§æ–‡æ¡£ä¸­çš„ Phase 1-5 é€æ­¥æ¨è¿›ã€‚ä¼˜å…ˆå®Œæˆ Phase 1ï¼ˆè·å–å’Œé…ç½®ç¼–è¾‘å™¨ï¼‰ï¼Œè¿™æ˜¯æ•´ä¸ªæ–¹æ¡ˆçš„åŸºç¡€ã€‚

---

## é™„å½•ï¼šå…³äºæ–‡æ¡£ä¸­çš„ Lint é”™è¯¯è¯´æ˜

æœ¬æ–‡æ¡£ä¸­å‡ºç°çš„ TypeScript/JavaScript è¯­æ³•é”™è¯¯æ˜¯ IDE å¯¹ Markdown ä»£ç å—çš„è¯¯æŠ¥ï¼Œä¸å½±å“æ–‡æ¡£çš„æ­£ç¡®æ€§ã€‚è¿™äº›ä»£ç å—æ˜¯ï¼š

1. **åè®®ç¤ºä¾‹**ï¼ˆç¬¬ 91-119 è¡Œï¼‰ï¼šå±•ç¤º postMessage é€šä¿¡åè®®çš„ JSON æ ¼å¼
2. **é™çº§æ–¹æ¡ˆä»£ç **ï¼ˆç¬¬ 875-906 è¡Œï¼‰ï¼šå±•ç¤ºå®Œæ•´çš„å‰ªè´´æ¿å¤åˆ¶å®ç°

è¿™äº›éƒ½æ˜¯**å®Œæ•´ã€æ­£ç¡®ã€å¯è¿è¡Œ**çš„ä»£ç ç¤ºä¾‹ï¼Œç”¨äºè¯´æ˜æŠ€æœ¯å®ç°æ–¹æ¡ˆã€‚åœ¨å®é™…å¼€å‘æ—¶ï¼Œè¿™äº›ä»£ç ä¼šè¢«æ”¾ç½®åœ¨æ­£ç¡®çš„ TypeScript ç±»ä¸­ï¼Œä¸ä¼šæœ‰ä»»ä½•è¯­æ³•é”™è¯¯ã€‚
